<app-navbar [navLinks]="navLinks"></app-navbar>

<div class="container mt-4">
  <div class="row">
    <div class="col-md-12">
      <h2 class="mb-4">
        <i class="bi bi-shield-check"></i> Super Admin Dashboard
      </h2>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-white bg-info">
        <div class="card-body">
          <h5 class="card-title">
            <i class="bi bi-people"></i> Total Users
          </h5>
          <h2>{{ allUsers.length }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-warning">
        <div class="card-body">
          <h5 class="card-title">
            <i class="bi bi-clock-history"></i> Pending Admins
          </h5>
          <h2>{{ pendingAdmins.length }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-success">
        <div class="card-body">
          <h5 class="card-title">
            <i class="bi bi-check-circle"></i> Approved Users
          </h5>
          <h2>{{ approvedCount }}</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3">
    <li class="nav-item">
      <a class="nav-link" [class.active]="activeTab === 'pending'" 
         (click)="activeTab = 'pending'" style="cursor: pointer;">
        <i class="bi bi-hourglass-split"></i> Pending Admins ({{ pendingAdmins.length }})
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" [class.active]="activeTab === 'all'" 
         (click)="activeTab = 'all'" style="cursor: pointer;">
        <i class="bi bi-people"></i> All Users ({{ allUsers.length }})
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" [class.active]="activeTab === 'customers'" 
         (click)="activeTab = 'customers'" style="cursor: pointer;">
        <i class="bi bi-person"></i> Pending Customers ({{ pendingCustomers.length }})
      </a>
    </li>
  </ul>

  <!-- Pending Admins Tab -->
  <div *ngIf="activeTab === 'pending'">
    <div class="card">
      <div class="card-header bg-warning text-white">
        <h5 class="mb-0">
          <i class="bi bi-person-badge"></i> Pending Admin Approvals
        </h5>
      </div>
      <div class="card-body">
        <div class="mb-3" *ngIf="pendingAdmins.length > 0">
          <div class="row g-2">
            <div class="col-md-8">
              <input type="text" 
                     class="form-control" 
                     [(ngModel)]="searchTermAdmins" 
                     (ngModelChange)="filterPendingAdmins()"
                     placeholder="ðŸ” Search by name, email, or contact...">
            </div>
            <div class="col-md-4">
              <select class="form-select" 
                      [(ngModel)]="filterAdminRole"
                      (ngModelChange)="filterPendingAdmins()">
                <option value="ALL">All Roles</option>
                <option value="ADMIN">Admin</option>
                <option value="SUPER_ADMIN">Super Admin</option>
              </select>
            </div>
          </div>
        </div>
        <div *ngIf="pendingAdmins.length === 0" class="alert alert-info">
          <i class="bi bi-info-circle"></i> No pending admin approvals
        </div>
        <div *ngIf="filteredPendingAdmins.length === 0 && pendingAdmins.length > 0" class="alert alert-warning">
          <i class="bi bi-search"></i> No admins match your search.
        </div>
        <div class="table-responsive" *ngIf="filteredPendingAdmins.length > 0">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Contact</th>
                <th>Role</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of filteredPendingAdmins">
                <td>{{ user.firstName }} {{ user.lastName }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.contact }}</td>
                <td><span class="badge bg-primary">{{ user.role }}</span></td>
                <td><span class="badge bg-warning">{{ user.status }}</span></td>
                <td class="text-nowrap">
                  <button class="btn btn-success btn-sm" 
                          (click)="approveAdmin(user.id!)"
                          title="Approve admin">
                    <i class="bi bi-check-circle"></i>
                  </button>
                  <button class="btn btn-danger btn-sm" 
                          (click)="deleteUser(user.id!)"
                          title="Delete admin">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Pending Customers Tab -->
  <div *ngIf="activeTab === 'customers'">
    <div class="card">
      <div class="card-header bg-info text-white">
        <h5 class="mb-0">
          <i class="bi bi-person"></i> Pending Customer Approvals
        </h5>
      </div>
      <div class="card-body">
        <div class="mb-3" *ngIf="pendingCustomers.length > 0">
          <input type="text" 
                 class="form-control" 
                 [(ngModel)]="searchTermCustomers" 
                 (ngModelChange)="filterPendingCustomers()"
                 placeholder="ðŸ” Search by name, email, or contact...">
        </div>
        <div *ngIf="pendingCustomers.length === 0" class="alert alert-info">
          <i class="bi bi-info-circle"></i> No pending customer approvals
        </div>
        <div *ngIf="filteredPendingCustomers.length === 0 && pendingCustomers.length > 0" class="alert alert-warning">
          <i class="bi bi-search"></i> No customers match your search.
        </div>
        <div class="table-responsive" *ngIf="filteredPendingCustomers.length > 0">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Contact</th>
                <th>Address</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of filteredPendingCustomers">
                <td>{{ user.firstName }} {{ user.lastName }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.contact }}</td>
                <td>{{ user.address }}</td>
                <td><span class="badge bg-warning">{{ user.status }}</span></td>
                <td class="text-nowrap">
                  <button class="btn btn-success btn-sm" 
                          (click)="approveCustomer(user.id!)"
                          title="Approve customer">
                    <i class="bi bi-check-circle"></i>
                  </button>
                  <button class="btn btn-danger btn-sm" 
                          (click)="deleteUser(user.id!)"
                          title="Delete customer">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- All Users Tab -->
  <div *ngIf="activeTab === 'all'">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
          <i class="bi bi-people"></i> All Users
        </h5>
      </div>
      <div class="card-body">
        <div class="mb-3" *ngIf="allUsers.length > 0">
          <div class="row g-2">
            <div class="col-md-6">
              <input type="text" 
                     class="form-control" 
                     [(ngModel)]="searchTermAllUsers" 
                     (ngModelChange)="filterAllUsers()"
                     placeholder="ðŸ” Search by name, email, or contact...">
            </div>
            <div class="col-md-3">
              <select class="form-select" 
                      [(ngModel)]="filterAllUsersRole"
                      (ngModelChange)="filterAllUsers()">
                <option value="ALL">All Roles</option>
                <option value="CUSTOMER">Customer</option>
                <option value="ADMIN">Admin</option>
                <option value="SUPER_ADMIN">Super Admin</option>
              </select>
            </div>
            <div class="col-md-3">
              <select class="form-select" 
                      [(ngModel)]="filterAllUsersStatus"
                      (ngModelChange)="filterAllUsers()">
                <option value="ALL">All Status</option>
                <option value="PENDING">Pending</option>
                <option value="APPROVED">Approved</option>
              </select>
            </div>
          </div>
        </div>
        <div *ngIf="filteredAllUsers.length === 0 && allUsers.length > 0" class="alert alert-warning">
          <i class="bi bi-search"></i> No users match your search.
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Contact</th>
                <th>Role</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of filteredAllUsers">
                <td>{{ user.firstName }} {{ user.lastName }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.contact }}</td>
                <td><span class="badge bg-primary">{{ user.role }}</span></td>
                <td>
                  <span class="badge" 
                        [class.bg-success]="user.status === 'APPROVED'"
                        [class.bg-warning]="user.status === 'PENDING'"
                        [class.bg-danger]="user.status === 'DELETED'">
                    {{ user.status }}
                  </span>
                </td>
                <td class="text-nowrap">
                  <button class="btn btn-danger btn-sm" 
                          (click)="deleteUser(user.id!)"
                          *ngIf="user.role !== 'SUPER_ADMIN'"
                          title="Delete user">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>
