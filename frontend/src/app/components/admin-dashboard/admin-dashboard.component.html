<app-navbar [navLinks]="navLinks"></app-navbar>

<div class="container mt-4">
      <h2 class="mb-4">
        <i class="bi bi-person-badge"></i> Admin Dashboard
      </h2>

      <!-- Stats -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card text-white bg-primary">
            <div class="card-body">
              <h5><i class="bi bi-box-seam"></i> Total Shipments</h5>
                    
        <h2>{{ shipments.length }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-white bg-warning">
            <div class="card-body">
              <h5><i class="bi bi-clock"></i> Pending Customers</h5>
              <h2>{{ pendingCustomers.length }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-white bg-info">
            <div class="card-body">
              <h5><i class="bi bi-people"></i> Total Customers</h5>
              <h2>{{ allUsers.length }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-white bg-success">
            <div class="card-body">
              <h5><i class="bi bi-check-circle"></i> Delivered</h5>
              <h2>{{ deliveredCount }}</h2>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabs -->
      <ul class="nav nav-tabs mb-3">
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'customers'" 
             (click)="activeTab = 'customers'" style="cursor: pointer;">
            <i class="bi bi-person-check"></i> Pending Customers
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'shipments'" 
             (click)="activeTab = 'shipments'" style="cursor: pointer;">
            <i class="bi bi-box"></i> All Shipments
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'users'" 
             (click)="activeTab = 'users'" style="cursor: pointer;">
            <i class="bi bi-people"></i> All Users
          </a>
        </li>
      </ul>

      <!-- Pending Customers -->
      <div *ngIf="activeTab === 'customers'" class="card">
        <div class="card-header bg-warning text-white">
          <h5 class="mb-0"><i class="bi bi-person-check"></i> Pending Customer Approvals</h5>
        </div>
        <div class="card-body">
          <div class="mb-3" *ngIf="pendingCustomers.length > 0">
            <div class="row g-2">
              <div class="col-md-8">
                <input type="text" 
                       class="form-control" 
                       [(ngModel)]="searchTermCustomers" 
                       (ngModelChange)="filterPendingCustomers()"
                       placeholder="ðŸ” Search by name, email, or contact...">
              </div>
              <div class="col-md-4">
                <select class="form-select" 
                        [(ngModel)]="filterCustomerStatus"
                        (ngModelChange)="filterPendingCustomers()">
                  <option value="ALL">All Status</option>
                  <option value="PENDING">Pending</option>
                  <option value="APPROVED">Approved</option>
                </select>
              </div>
            </div>
          </div>
          <div *ngIf="pendingCustomers.length === 0" class="alert alert-info">
            No pending customers
          </div>
          <div *ngIf="filteredPendingCustomers.length === 0 && pendingCustomers.length > 0" class="alert alert-warning">
            <i class="bi bi-search"></i> No customers match your search.
          </div>
          <div class="table-responsive" *ngIf="filteredPendingCustomers.length > 0">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Contact</th>
                  <th>Address</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of filteredPendingCustomers">
                  <td>{{ user.firstName }} {{ user.lastName }}</td>
                  <td>{{ user.email }}</td>
                  <td>{{ user.contact }}</td>
                  <td>{{ user.address }}</td>
                  <td class="text-nowrap">
                    <button class="btn btn-success btn-sm" 
                            (click)="approveCustomer(user.id!)"
                            title="Approve customer">
                      <i class="bi bi-check-circle"></i>
                    </button>
                    <button class="btn btn-primary btn-sm" 
                            (click)="editUser(user)"
                            title="Edit customer">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" 
                            (click)="deleteUser(user.id!)"
                            title="Delete customer">
                      <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Shipments -->
      <div *ngIf="activeTab === 'shipments'" class="card">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-box-seam"></i> All Shipments</h5>
        </div>
        <div class="card-body">
          <div class="mb-3" *ngIf="shipments.length > 0">
            <div class="row g-2">
              <div class="col-md-5">
                <input type="text" 
                       class="form-control" 
                       [(ngModel)]="searchTermShipments" 
                       (ngModelChange)="filterShipments()"
                       placeholder="ðŸ” Search by ID, origin, destination...">
              </div>
              <div class="col-md-4">
                <input type="text" 
                       class="form-control" 
                       [(ngModel)]="filterShipmentCustomer" 
                       (ngModelChange)="filterShipments()"
                       placeholder="Filter by customer name...">
              </div>
              <div class="col-md-3">
                <select class="form-select" 
                        [(ngModel)]="filterShipmentStatus"
                        (ngModelChange)="filterShipments()">
                  <option value="ALL">All Status</option>
                  <option value="REQUESTED">Requested</option>
                  <option value="APPROVED">Approved</option>
                  <option value="IN_TRANSIT">In Transit</option>
                  <option value="DELIVERED">Delivered</option>
                </select>
              </div>
            </div>
          </div>
          <div *ngIf="shipments.length === 0" class="alert alert-info">
            No shipments yet
          </div>
          <div *ngIf="filteredShipments.length === 0 && shipments.length > 0" class="alert alert-warning">
            <i class="bi bi-search"></i> No shipments match your search.
          </div>
          <div class="table-responsive" *ngIf="filteredShipments.length > 0">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Customer</th>
                  <th>From</th>
                  <th>To</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let shipment of filteredShipments">
                  <td>#{{ shipment.id }}</td>
                  <td>{{ shipment.user?.firstName }} {{ shipment.user?.lastName }}</td>
                  <td>{{ shipment.origin }}</td>
                  <td>{{ shipment.destination }}</td>
                  <td>
                    <span class="badge" 
                          [class.bg-warning]="shipment.status === 'REQUESTED'"
                          [class.bg-info]="shipment.status === 'APPROVED'"
                          [class.bg-primary]="shipment.status === 'IN_TRANSIT'"
                          [class.bg-success]="shipment.status === 'DELIVERED'">
                      {{ shipment.status }}
                    </span>
                  </td>
                  <td class="text-nowrap">
                    <div class="d-flex align-items-center gap-1">
                      <button class="btn btn-success btn-sm" 
                              (click)="approveShipment(shipment.id!)"
                              *ngIf="shipment.status === 'REQUESTED'"
                              title="Approve shipment">
                        <i class="bi bi-check-circle"></i>
                      </button>
                      <select class="form-select form-select-sm" 
                              (change)="updateShipmentStatus(shipment.id!, $event)"
                              [value]="shipment.status"
                              style="width: auto; min-width: 120px;">
                        <option value="REQUESTED">REQUESTED</option>
                        <option value="APPROVED">APPROVED</option>
                        <option value="IN_TRANSIT">IN TRANSIT</option>
                        <option value="DELIVERED">DELIVERED</option>
                      </select>
                      <button class="btn btn-danger btn-sm" 
                              (click)="deleteShipment(shipment.id!)"
                              title="Delete shipment">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- All Users -->
      <div *ngIf="activeTab === 'users'" class="card">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="bi bi-people"></i> All Users</h5>
        </div>
        <div class="card-body">
          <div class="mb-3" *ngIf="allUsers.length > 0">
            <div class="row g-2">
              <div class="col-md-6">
                <input type="text" 
                       class="form-control" 
                       [(ngModel)]="searchTermUsers" 
                       (ngModelChange)="filterAllUsers()"
                       placeholder="ðŸ” Search by name, email, or contact...">
              </div>
              <div class="col-md-3">
                <select class="form-select" 
                        [(ngModel)]="filterUserRole"
                        (ngModelChange)="filterAllUsers()">
                  <option value="ALL">All Roles</option>
                  <option value="CUSTOMER">Customer</option>
                  <option value="ADMIN">Admin</option>
                  <option value="SUPER_ADMIN">Super Admin</option>
                </select>
              </div>
              <div class="col-md-3">
                <select class="form-select" 
                        [(ngModel)]="filterUserStatus"
                        (ngModelChange)="filterAllUsers()">
                  <option value="ALL">All Status</option>
                  <option value="PENDING">Pending</option>
                  <option value="APPROVED">Approved</option>
                </select>
              </div>
            </div>
          </div>
          <div *ngIf="filteredAllUsers.length === 0 && allUsers.length > 0" class="alert alert-warning">
            <i class="bi bi-search"></i> No users match your search.
          </div>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Contact</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of filteredAllUsers">
                  <td>{{ user.firstName }} {{ user.lastName }}</td>
                  <td>{{ user.email }}</td>
                  <td>{{ user.contact }}</td>
                  <td><span class="badge bg-primary">{{ user.role }}</span></td>
                  <td>
                    <span class="badge" 
                          [class.bg-success]="user.status === 'APPROVED'"
                          [class.bg-warning]="user.status === 'PENDING'">
                      {{ user.status }}
                    </span>
                  </td>
                  <td class="text-nowrap">
                    <button class="btn btn-primary btn-sm" 
                            (click)="editUser(user)"
                            title="Edit user">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" 
                            (click)="deleteUser(user.id!)"
                            title="Delete user">
                      <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>


    </div>

<
!-- Edit User Modal -->
<div class="modal fade" [class.show]="showEditUserModal" [style.display]="showEditUserModal ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-pencil"></i> Edit User
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeEditUserModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">
                <i class="bi bi-person"></i> First Name <span class="text-danger">*</span>
              </label>
              <input type="text" 
                     class="form-control" 
                     [(ngModel)]="editingUser.firstName" 
                     name="firstName"
                     required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">
                <i class="bi bi-person"></i> Last Name <span class="text-danger">*</span>
              </label>
              <input type="text" 
                     class="form-control" 
                     [(ngModel)]="editingUser.lastName" 
                     name="lastName"
                     required>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">
              <i class="bi bi-envelope"></i> Email <span class="text-danger">*</span>
            </label>
            <input type="email" 
                   class="form-control" 
                   [(ngModel)]="editingUser.email" 
                   name="email"
                   required
                   readonly>
            <small class="text-muted">Email cannot be changed</small>
          </div>

          <div class="mb-3">
            <label class="form-label">
              <i class="bi bi-telephone"></i> Contact <span class="text-danger">*</span>
            </label>
            <input type="text" 
                   class="form-control" 
                   [(ngModel)]="editingUser.contact" 
                   name="contact"
                   placeholder="+23212345678"
                   required>
          </div>

          <div class="mb-3">
            <label class="form-label">
              <i class="bi bi-geo-alt"></i> Address
            </label>
            <textarea class="form-control" 
                      [(ngModel)]="editingUser.address" 
                      name="address"
                      rows="3"></textarea>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">
                <i class="bi bi-person-badge"></i> Role
              </label>
              <input type="text" 
                     class="form-control" 
                     [value]="editingUser.role" 
                     readonly>
              <small class="text-muted">Role cannot be changed</small>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">
                <i class="bi bi-check-circle"></i> Status
              </label>
              <input type="text" 
                     class="form-control" 
                     [value]="editingUser.status" 
                     readonly>
              <small class="text-muted">Status cannot be changed here</small>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeEditUserModal()">
          <i class="bi bi-x-circle"></i> Cancel
        </button>
        <button type="button" class="btn btn-primary" (click)="saveUserChanges()">
          <i class="bi bi-check-circle"></i> Save Changes
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal-backdrop fade" [class.show]="showEditUserModal" *ngIf="showEditUserModal" (click)="closeEditUserModal()"></div>
